<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>XDXX - Canales XXX en Vivo 24/7</title>

  <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    body { margin:0; background:#000; color:#eee; font-family:system-ui; overflow-x:hidden; }
    #age-gate { position:fixed; inset:0; background:rgba(0,0,0,0.98); backdrop-filter:blur(12px); z-index:9999; display:flex; align-items:center; justify-content:center; }
    .age-box { background:rgba(15,15,20,0.95); border:3px solid #ff0066; border-radius:20px; padding:4rem 2.5rem; text-align:center; max-width:520px; box-shadow:0 0 80px #ff006680; }
    .age-box h1 { font-size:7rem; color:#ff0066; margin-bottom:1rem; }
    .age-box p { font-size:1.5rem; margin:1.8rem 0 3rem; }
    .age-btn { padding:1.3rem 4rem; font-size:1.5rem; border:none; border-radius:50px; cursor:pointer; margin:1rem; transition:all .3s; }
    #enter { background:#ff0066; color:white; }
    #enter:hover { background:#e6005c; transform:scale(1.08); }
    #exit { background:#222; color:#ccc; }
    #exit:hover { background:#333; color:white; }
    #main-content { display:none; padding:1.5rem; max-width:1800px; margin:0 auto; }
    h1 { text-align:center; color:#ff0066; font-size:4rem; margin:1rem 0 2rem; text-shadow:0 0 20px #ff0066aa; }
    #player-container { max-width:1400px; margin:0 auto 3rem; border-radius:16px; overflow:hidden; box-shadow:0 0 50px #ff006680; }
    .video-js { width:100%; aspect-ratio:16/9; }
    .category-title { color:#ff0066; font-size:2.5rem; margin:3rem 0 1rem; border-bottom:2px solid #222; padding-bottom:0.8rem; }
    .channel-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(260px,1fr)); gap:1.2rem; }
    .channel-card { background:#111; border-radius:12px; overflow:hidden; border:2px solid transparent; transition:all .25s; cursor:pointer; position:relative; }
    .channel-card:hover { transform:scale(1.06); border-color:#ff0066; box-shadow:0 0 30px #ff0066aa; }
    .channel-card img { width:100%; height:150px; object-fit:cover; }
    .channel-card .title { position:absolute; bottom:0; left:0; right:0; background:linear-gradient(to top, rgba(0,0,0,.9), transparent); padding:1rem; font-size:1.1rem; text-align:center; }
    .fav-btn { position:absolute; top:8px; right:8px; background:rgba(0,0,0,0.7); border:none; color:#fff; font-size:1.6rem; width:36px; height:36px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all .2s; }
    .fav-btn.active { color:#ff0066; background:rgba(255,0,102,0.3); }
    .fav-btn:hover { transform:scale(1.2); }
    .active-channel { border-color:#ff0066 !important; box-shadow:0 0 40px #ff0066cc !important; transform:scale(1.08); }
    #loading { text-align:center; color:#ff0066; font-size:1.8rem; margin:4rem 0; }
  </style>
</head>
<body>

<div id="age-gate">
  <div class="age-box">
    <h1>XDXX</h1>
    <h1>18+</h1>
    <p>Contenido explícito solo para mayores de 18 años.<br>Confirma que eres mayor de edad en tu país.</p>
    <button class="age-btn" id="enter">Soy mayor de 18 - Entrar</button>
    <button class="age-btn" id="exit">No tengo 18 años / Salir</button>
  </div>
</div>

<div id="main-content">
  <h1>XDXX - Canales en Vivo</h1>
  <div id="player-container">
    <video id="my-video" class="video-js vjs-big-play-centered" controls preload="auto" poster="https://via.placeholder.com/1280x720/000/222?text=Selecciona+un+canal"></video>
  </div>
  <div id="loading">Cargando canales... (puede tardar 5-10 segundos la primera vez)</div>
  <div id="categories"></div>
</div>

<script>
const player = videojs('my-video', { fluid: true, autoplay: false, controls: true, muted: false });
const categoriesContainer = document.getElementById('categories');
const loadingDiv = document.getElementById('loading');

let favorites = JSON.parse(localStorage.getItem('xdxxFavorites')) || [];

function saveFavorites() { localStorage.setItem('xdxxFavorites', JSON.stringify(favorites)); }

function renderFavorites() {
  if (favorites.length === 0) return;
  const favSection = document.createElement('div');
  favSection.id = 'favorites-section';
  const title = document.createElement('h2');
  title.className = 'category-title';
  title.textContent = '⭐ Tus Favoritos';
  favSection.appendChild(title);
  const grid = document.createElement('div');
  grid.className = 'channel-grid';
  favorites.forEach(fav => {
    const card = createChannelCard(fav, true);
    grid.appendChild(card);
  });
  favSection.appendChild(grid);
  categoriesContainer.prepend(favSection);
}

function createChannelCard(channel, isFav = false) {
  const card = document.createElement('div');
  card.className = 'channel-card';
  card.dataset.url = channel.url;
  card.innerHTML = `
    <img src="${channel.thumbnail || 'https://via.placeholder.com/260x150/111/222?text='+encodeURIComponent(channel.nombre)}" 
         alt="${channel.nombre}" loading="lazy" onerror="this.src='https://via.placeholder.com/260x150/000/555?text=XDXX'"/>
    <div class="title">${channel.nombre}</div>
    <button class="fav-btn ${favorites.some(f => f.url === channel.url) ? 'active' : ''}">❤️</button>
  `;
  card.addEventListener('click', (e) => {
    if (e.target.classList.contains('fav-btn')) return;
    document.querySelectorAll('.channel-card').forEach(el => el.classList.remove('active-channel'));
    card.classList.add('active-channel');
    loadStream(channel.url, channel.nombre);
  });
  const favBtn = card.querySelector('.fav-btn');
  favBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const index = favorites.findIndex(f => f.url === channel.url);
    if (index === -1) {
      favorites.push(channel);
      favBtn.classList.add('active');
    } else {
      favorites.splice(index, 1);
      favBtn.classList.remove('active');
      if (isFav) card.remove();
    }
    saveFavorites();
    if (favorites.length === 0 && document.getElementById('favorites-section')) document.getElementById('favorites-section').remove();
  });
  return card;
}

async function loadChannels() {
  try {
    const res = await fetch('https://raw.githubusercontent.com/JJFUTBOL15/xdxx/refs/heads/main/canales.json');
    if (!res.ok) throw new Error('Error al cargar JSON');
    const data = await res.json();
    loadingDiv.style.display = 'none';
    renderFavorites();
    data.categorias.forEach(cat => {
      const title = document.createElement('h2');
      title.className = 'category-title';
      title.textContent = cat.nombre;
      categoriesContainer.appendChild(title);
      const grid = document.createElement('div');
      grid.className = 'channel-grid';
      cat.canales.forEach(channel => {
        const card = createChannelCard(channel);
        grid.appendChild(card);
      });
      categoriesContainer.appendChild(grid);
    });
  } catch (err) {
    loadingDiv.innerHTML = `<p style="color:#ff0066; font-size:1.6rem;">⚠️ Error al cargar canales. Prueba refrescar (F5) o en modo incógnito.</p>`;
    console.error('Error cargando JSON:', err);
  }
}

function loadStream(url, name) {
  const video = player.tech_.el();
  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      player.play().catch(() => console.log('Autoplay bloqueado'));
      player.poster(`https://via.placeholder.com/1280x720/000/222?text=${encodeURIComponent(name)}`);
    });
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    player.src({ type: 'application/x-mpegURL', src: url });
    player.play().catch(() => {});
  } else {
    alert('Tu navegador no soporta HLS. Prueba Chrome/Firefox/Safari.');
  }
}

// AGE GATE
document.getElementById('enter').onclick = () => {
  localStorage.setItem('xdxxVerified', 'true');
  document.getElementById('age-gate').style.display = 'none';
  document.getElementById('main-content').style.display = 'block';
  loadChannels();
};

document.getElementById('exit').onclick = () => window.location.href = 'https://google.com';

if (localStorage.getItem('xdxxVerified') === 'true') {
  document.getElementById('age-gate').style.display = 'none';
  document.getElementById('main-content').style.display = 'block';
  loadChannels();
}
</script>
</body>
</html>
